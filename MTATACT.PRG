***
*** ACTUALIZA LOS TIPOS DE ACTIVIDADES
***
PUSH KEY CLEAR
DEFI WIND WINDTIP FROM 12,30 TO 20,79;
          TITLE "< TIPOS DE ACTIVIDADES >" ;
          FOOTER " F1=Inc, F2=Mod, F3=Eli, F4=Bus, Enter=Salir " ;
          DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
ACTI WIND WINDTIP
ON KEY LABEL F1  DO PROTIPI
ON KEY LABEL F2  DO PROTIPM
ON KEY LABEL F3  DO PROTIPE
ON KEY LABEL F4  DO PROTIPB
ON KEY LABEL ENTER KEYBOARD '{CTRL+W}'
SELECT MTTACT
BROWSE FIELDS CODTIP:H="Tipo",DESTIP:H="Descripcion";
       NOAPPEND NODELETE NOEDIT NOMENU NOOPTIMIZE REST SAVE IN WINDOW WINDTIP
DEACT WIND WINDTIP
POP KEY
RETURN

************
PROC PROTIPI
************
PUSH KEY CLEAR
STORE "INCLUIR" TO WFLAGRTACT
SCATT MEMV BLANK
DO WHILE .T.
   SELECT MTTACT
   STORE SPACE(LEN(M.DESTIP)) TO M.DESTIP
   DO GETTIP
   IF LASTKEY()=27
      EXIT
   ENDIF
ENDDO
POP KEY
RETURN

************
PROC PROTIPM
************
PUSH KEY CLEAR
STORE "MODIFICAR" TO WFLAGRTACT
SELECT MTTACT
IF .NOT. EOF()
   SCATT MEMV
   DO GETTIP
ENDIF
POP KEY
RETURN

************
PROC PROTIPE
************
SELECT MTTACT
IF EOF()
   RETURN
ENDIF
PUSH KEY CLEAR
STORE "ELIMINAR" TO WFLAGRTACT
STORE 2 TO WOP
DO CANCACEP WITH WFLAGRTACT
IF WOP=2
   IF RECLOC()
      DELETE
      UNLOCK
   ELSE
      DO PROCNUL
   ENDIF
ENDIF
POP KEY
RETURN

************
PROC PROTIPB
************
PUSH KEY CLEAR
STORE "BUSCAR" TO WFLAGRTACT
DEFI WIND WINDBUS FROM 12,35 TO 14,75;
          TITLE  WFLAGRTACT ;
          DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
ACTI WIND WINDBUS
DO WHILE .T.
   SCATT MEMV BLANK
   @ 0,1 GET M.CODTIP
   READ
   IF LASTKEY()=27
      EXIT
   ENDIF
   IF M.CODTIP<>SPACE(LEN(M.CODTIP))
      SELECT MTTACT
      SEEK M.CODTIP
      IF FOUND()
         EXIT
      ELSE
         STORE "NO REGISTRADO, REINTENTE" TO WTEXT
         DO AVISO WITH WTEXT
         LOOP
      ENDIF
   ELSE
      @ 0,LEN(M.CODTIP)+2 GET M.DESTIP
      READ
      IF LASTKEY()=27
         EXIT
      ENDIF
      IF M.DESTIP<>SPACE(LEN(M.DESTIP))
         SELECT MTTACT
         LOCATE FOR M.DESSEC=DESTIP
         IF FOUND()
            EXIT
         ELSE
            STORE "NO REGISTRADO, REINTENTE" TO WTEXT
            DO AVISO WITH WTEXT
            LOOP
         ENDIF
      ENDIF
      EXIT
   ENDIF
ENDDO
SELECT MTTACT
RELE WIND WINDBUS
POP KEY
RETURN

***********
PROC GETTIP
***********
DEFI WIND WINDGETT FROM 13,30 TO 19,79;
          TITLE  WFLAGRTACT ;
          DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
ACTI WIND WINDGETT
DO WHILE .T.
   @ 00,01 SAY "Tipo ......:"
   @ 01,01 SAY "Descripcion:"
   IF WFLAGRTACT="INCLUIR"
      @ 0,14 GET M.CODTIP
      READ
      IF LASTKEY()=27
         EXIT
      ENDIF
      SELECT MTTACT
      SEEK M.CODTIP
      IF FOUND()
         @ 1,14 SAY DESTIP
         STORE "CODIGO YA EXISTE" TO WTEXT
         DO AVISO WITH WTEXT
         LOOP
      ENDIF
   ELSE
      @ 0,14 SAY M.CODTIP
   ENDIF
   @ 1,14   GET M.DESTIP VALID VALDES()
   READ
   IF LASTKEY()=27
      EXIT
   ENDIF
   STORE 1 TO WOP
   DO ACEPCANC WITH WFLAGRTACT
   IF WOP=1
      SELECT MTTACT
      IF WFLAGRTACT="INCLUIR"
         IF FILLOC()
            APPEND BLANK
            GATH MEMV
            UNLOCK ALL
         ELSE
           DO PROCNUL
         ENDIF
      ELSE
         IF RECLOC()
            GATH MEMV
            UNLOCK ALL
         ELSE
            DO PROCNUL
         ENDIF
      ENDIF
   ENDIF
   EXIT
ENDDO
RELE WIND WINDGETT
RETURN

***********
FUNC VALDES
***********
IF M.DESTIP<>SPACE(LEN(M.DESTIP))
   RETURN .T.
ELSE
   RETURN .F.
ENDIF



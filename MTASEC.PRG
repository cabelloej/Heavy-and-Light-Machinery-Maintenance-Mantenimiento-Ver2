***
*** ACTUALIZA SECCIONES DE LAS CATEGORIAS
***
STORE "< CATEGORIA: "+ALLTRIM(MTCAT.DESCAT)+" >" TO WTITLE
PUSH KEY CLEAR
DEFI WIND WINDSEC FROM 03,00 TO 20,79;
          TITLE WTITLE ;
          FOOTER " F1=Inc, F2=Mod, F3=Eli, F4=Bus, F11=Activ, Enter=Sal " ;
          DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
ACTI WIND WINDSEC
ON KEY LABEL F1  DO PROSECI
ON KEY LABEL F2  DO PROSECM
ON KEY LABEL F3  DO PROSECE
ON KEY LABEL F4  DO PROSECB
ON KEY LABEL F11 DO PROCACT
ON KEY LABEL ENTER KEYBOARD '{CTRL+W}'
SELECT MTSEC
BROWSE FIELDS CODSEC:H="Seccion",DESSEC:H="Descripcion";
       KEY  MTCAT.CODCAT;
       NOAPPEND NODELETE NOEDIT NOMENU NOOPTIMIZE REST SAVE IN WINDOW WINDSEC
DEACT WIND WINDSEC
POP KEY
RETURN

************
PROC PROSECI
************
PUSH KEY CLEAR
STORE "INCLUIR" TO WFLAGRSEC
SCATT MEMV BLANK
STORE MTCAT.CODCAT TO M.CODCAT
DO WHILE .T.
   SELECT MTSEC
   STORE SPACE(LEN(M.DESSEC)) TO M.DESSEC
   DO GETSEC
   DO SHOWSECS
   IF LASTKEY()=27
      EXIT
   ENDIF
ENDDO
POP KEY
RETURN

************
PROC PROSECM
************
PUSH KEY CLEAR
STORE "MODIFICAR" TO WFLAGRSEC
SELECT MTSEC
IF .NOT. EOF()
   SCATT MEMV
   DO GETSEC
ENDIF
POP KEY
RETURN

************
PROC PROSECE
************
SELECT MTSEC
IF EOF()
   RETURN
ENDIF
PUSH KEY CLEAR
STORE "ELIMINAR" TO WFLAGRSEC
STORE 2 TO WOP
DO CANCACEP WITH WFLAGRSEC
IF WOP=2
   IF RECLOC()
      DELETE
      UNLOCK
   ELSE
      DO PROCNUL
   ENDIF
ENDIF
POP KEY
RETURN

************
PROC PROSECB
************
PUSH KEY CLEAR
STORE "BUSCAR" TO WFLAGRSEC
DEFI WIND WINDBUS FROM 04,5 TO 06,75;
          TITLE  WFLAGRSEC ;
          DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
ACTI WIND WINDBUS
DO WHILE .T.
   SCATT MEMV BLANK
   @ 0,1 GET M.CODSEC PICTURE ALLTRIM(WMASKSEC) VALID VALSEC()
   READ
   IF LASTKEY()=27
      EXIT
   ENDIF
   IF M.CODSEC<>SPACE(LEN(M.CODSEC))
      SELECT MTSEC
      SET ORDER TO MTSEC1
      SEEK MTCAT.CODCAT+M.CODSEC
      IF FOUND()
         EXIT
      ELSE
         STORE "NO REGISTRADO, REINTENTE" TO WTEXT
         DO AVISO WITH WTEXT
         LOOP
      ENDIF
   ELSE
      @ 0,LEN(M.CODSEC)+2 GET M.DESSEC
      READ
      IF LASTKEY()=27
         EXIT
      ENDIF
      IF M.DESSEC<>SPACE(LEN(M.DESSEC))
         SELECT MTSEC
         SET ORDER TO MTSEC2
         SEEK ALLTRIM(M.DESSEC)
         IF FOUND()
            EXIT
         ELSE
            STORE "NO REGISTRADO, REINTENTE" TO WTEXT
            DO AVISO WITH WTEXT
            LOOP
         ENDIF
      ENDIF
      EXIT
   ENDIF
ENDDO
SELECT MTSEC
SET ORDER TO MTSEC1
RELE WIND WINDBUS
POP KEY
RETURN

***********
PROC GETSEC
***********
DEFI WIND WINDGETS FROM 04,05 TO 07,75;
          TITLE  WFLAGRSEC ;
          DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
ACTI WIND WINDGETS
DO WHILE .T.
   @ 00,01 SAY "Seccion .............:"
   @ 01,01 SAY "Descripcion .........:"
   IF WFLAGRSEC="INCLUIR"
      @ 0,24 GET M.CODSEC PICTURE ALLTRIM(WMASKSEC) VALID VALSEC()
      READ
      IF LASTKEY()=27
         EXIT
      ENDIF
      SELECT MTSEC
      SEEK MTCAT.CODCAT+M.CODSEC
      IF FOUND()
         @ 1,24 SAY DESSEC
         STORE "CODIGO YA EXISTE" TO WTEXT
         DO AVISO WITH WTEXT
         LOOP
      ENDIF
      ***
      STORE .T. TO WPADRE
      DO VALSECPA
      IF .NOT.WPADRE
         LOOP
      ENDIF
   ELSE
      @ 0,24 SAY M.CODSEC
   ENDIF
   @ 1,24   GET M.DESSEC VALID VALDES()
   READ
   IF LASTKEY()=27
      EXIT
   ENDIF
   STORE 1 TO WOP
   DO ACEPCANC WITH WFLAGRSEC
   IF WOP=1
      SELECT MTSEC
      IF WFLAGRSEC="INCLUIR"
         IF FILLOC()
            APPEND BLANK
            GATH MEMV
            UNLOCK ALL
         ELSE
           DO PROCNUL
         ENDIF
      ELSE
         IF RECLOC()
            GATH MEMV
            UNLOCK ALL
         ELSE
            DO PROCNUL
         ENDIF
      ENDIF
   ENDIF
   EXIT
ENDDO
RELE WIND WINDGETS
RETURN

*************
PROC SHOWSECS
*************
*ACTI WIND WINDSEC
*SELECT MTSEC
*IF .NOT.EOF().AND.RECNO()>8
*   SKIP - 7
*ELSE
*   GO TOP
*ENDIF
*BROWSE FIELDS CODSEC:H="Seccion",DESSEC:H="Descripcion";
*       KEY MTCAT.CODCAT;
*       NOAPPEND NODELETE NOEDIT NOMENU NOOPTIMIZE NOWAIT;
*       REST SAVE IN WINDOW WINDSEC
RETURN

***********
FUNC VALDES
***********
IF M.DESSEC<>SPACE(LEN(M.DESSEC))
   RETURN .T.
ELSE
   RETURN .F.
ENDIF

************
PROC PROCACT
************
SELECT MTACT
SET ORDER TO MTACTXS
STORE "MTCAT.CODCAT+MTSEC.CODSEC" TO WKEYACT
DO MTAACT
SET ORDER TO MTACTXS
RETURN


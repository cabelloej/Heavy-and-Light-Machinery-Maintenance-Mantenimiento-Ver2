PROCEDURE INDICES
DEFI WIND WININD FROM 05,00 TO 07,22 ;
                 TITLE " REORGANIZAR " ;
                 DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
ACTI WIND WININD
@ 0,0 CLEAR
store 2 to wop
do while .t.
   store space(10) to wclaveind
   @ 00,00  say "Clave:" get wclaveind
   read
   if UPPER(wclaveind)<>"EJCM      "
      exit
   endif
   @ 00,00  get wop pict "@*H Aceptar ;Cancelar" defa wop
   read
   if lastkey()=13
      exit
   endif
enddo
if wop=1
   @ 00,00 
   @ 00,00 SAY "Favor esperar..."
else
   RELE WIND WININD
   RETURN
endif
***
USE SYSUSER
IF FILLOC()
   INDEX ON USERCODE  TO SYSUSER
   UNLOCK ALL
ELSE
   STORE "OPERACION RECHAZADA, REINTENTE" TO WTEXT
   DO AVISO WITH WTEXT
   CLOSE DATA
   CLOSE INDEX
   RETURN
ENDIF
***
USE SYSUSERD
IF FILLOC()
   INDEX ON USERCODE+PROGRAMA  TO SYSUSERD
   UNLOCK ALL
ELSE
   STORE "OPERACION RECHAZADA, REINTENTE" TO WTEXT
   DO AVISO WITH WTEXT
   CLOSE DATA
   CLOSE INDEX
   RETURN
ENDIF
***
USE SYSPRG
IF FILLOC()
   INDEX ON PROGRAMA TO SYSPRG
   UNLOCK ALL
ELSE
   STORE "OPERACION RECHAZADA, REINTENTE" TO WTEXT
   DO AVISO WITH WTEXT
   CLOSE DATA
   CLOSE INDEX
   RETURN
ENDIF
***
STORE "EL SISTEMA SE REINICIARA, OPRIMA <ENTER> PARA CONTINUAR." TO WTEXT
DO AVISO WITH WTEXT
RELE WIND WININD
RETURN
****************
PROCEDURE COMPACTA
DEFI WIND WINCOM FROM 05,00 TO 07,22 ;
                 TITLE " COMPACTAR " ;
                 DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
ACTI WIND WINCOM
@ 0,0 CLEAR
store 2 to wop
do while .t.
   store space(10) to wclaveind
   @ 00,00  say "Clave:" get wclaveind
   read
   if UPPER(wclaveind)<>"EJCM      "
      exit
   endif
   @ 00,00  get wop pict "@*H Aceptar ;Cancelar" defa wop
   read
   if lastkey()=13
      exit
   endif
enddo
if wop=1
   @ 00,00 
   @ 00,00 SAY "Favor esperar..."
else
   RELE WIND WINCOM
   RETURN
endif
***
USE SYSUSER EXCL
IF FILLOC()
   PACK
   UNLOCK ALL
ELSE
   STORE "OPERACION RECHAZADA, REINTENTE" TO WTEXT
   DO AVISO WITH WTEXT
   CLOSE DATA
   CLOSE INDEX
   RETURN
ENDIF
***
***
USE SYSUSERD EXCL
IF FILLOC()
   PACK
   UNLOCK ALL
ELSE
   STORE "OPERACION RECHAZADA, REINTENTE" TO WTEXT
   DO AVISO WITH WTEXT
   CLOSE DATA
   CLOSE INDEX
   RETURN
ENDIF
***
***
USE SYSPRG EXCL
IF FILLOC()
   PACK
   UNLOCK ALL
ELSE
   STORE "OPERACION RECHAZADA, REINTENTE" TO WTEXT
   DO AVISO WITH WTEXT
   CLOSE DATA
   CLOSE INDEX
   RETURN
ENDIF
STORE "EL SISTEMA SE REINICIARA, OPRIMA <ENTER> PARA CONTINUAR." TO WTEXT
DO AVISO WITH WTEXT
RELE WIND WINCOM
RETURN
****************
PROCEDURE RECLOC
DEFI WIND WINRLOCK FROM 12,05 TO 18,75 DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
STORE .F. TO WFLAGRL
STORE .F. TO WRECMES
STORE .T. TO WRECLOC
DO WHILE WRECLOC
   IF RLOCK()
      STORE .T. TO WFLAGRL
      EXIT
   ELSE
      IF .NOT. WRECMES
         ACTI WIND WINRLOCK
         @ 14,15 SAY "REGISTRO OCUPADO POR OTRO USUARIO, REINTENTANDO ..."
         @ 16,15 SAY "          OPRIMA [ESC] PARA ABANDONAR              "
         STORE .T. TO WRECMES
      ENDIF
      WVALUE = INKEY()
      IF WVALUE = 27
         EXIT
      ENDIF
   ENDIF
ENDDO
RELEASE WIND WINRLOCK
RETURN WFLAGRL
******************************************************************************
FUNC FILLOC
DEFI WIND WINFLOCK FROM 12,05 TO 18,75 DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
STORE .F. TO WFLAGFL
STORE .F. TO WFILMES
STORE .T. TO WFILLOC
DO WHILE WFILLOC
   IF FLOCK()
      STORE .T. TO WFLAGFL
      EXIT
   ELSE
      IF .NOT. WFILMES
         ACTI WIND WINFLOCK
         @ 14,15 SAY "ARCHIVO  OCUPADO POR OTRO USUARIO, REINTENTANDO ..."
         @ 16,15 SAY "          OPRIMA [ESC] PARA ABANDONAR              "
         STORE .T. TO WFILMES
      ENDIF
      WVALUE = INKEY()
      IF WVALUE = 27
         EXIT
      ENDIF
   ENDIF
ENDDO
RELEASE WIND WINFLOCK
RETURN WFLAGFL
*************************
PROCEDURE MENSAJE
PARAMETERS WTEXT
DEFI WIND WINMES FROM 22,0 TO 24,79 DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
ACTI WIND WINMES
@ 0,40-(LEN(WTEXT)/2) SAY WTEXT
RELEASE WIND WINMES
RETURN
*************************
PROCEDURE AVISO
PARAMETERS WTEXT
DEFI WIND WINAVI FROM 22,0 TO 24,79 DOUBLE NOFLOAT NOZOOM NOGROW SHADOW COLOR SCHEME 10
ACTI WIND WINAVI
?? CHR(7)
@ 0,40-(LEN(WTEXT)/2) SAY WTEXT
READ
RELEASE WIND WINAVI
RETURN
*************************
PROCEDURE CHKPRINT
PARAMETERS SALTAR
store .t. to wprinting
do while wprinting
   store "Prepare la impresora y oprima <ENTTER> para continuar o (R)echazar" to Qmes
   @ 23,1
   @ 23,40-(len(Qmes)/2) say Qmes
   store " " to wstat
   @ 23,78 get wstat
   read
   if upper(wstat) = "R"
      store 1 to saltar
      store .f. to wprinting
   else
      store 0 to saltar
      if sys(13) = "READY"
         store .f. to wprinting
      endif
   endif
   @ 23,1
enddo
RETURN
****************
PROCEDURE CHKACC
PARAMETERS WUSERCODE,WPROGRAMA,WACCESO
SELECT SYSUSERD
STORE WUSERCODE+WPROGRAMA TO WCLAVEACC
SEEK WCLAVEACC
IF FOUND()
   STORE ACCESO TO WACCESO
ELSE
   STORE SPACE(1) TO WACCESO
ENDIF
RETURN
*****************
PROCEDURE INFORMA
*****************
PARAMETERS QQWW
STORE "N" TO QW01
STORE "E" TO QW02
STORE "W" TO QW03
STORE "S" TO QW04
STORE "C" TO QW05
STORE "A" TO QW06
STORE " " TO QW07
STORE " " TO QW08
STORE " " TO QW09
STORE " " TO QW10
STORE " " TO QW11
STORE " " TO QW12
STORE " " TO QW13
STORE " " TO QW14
STORE " " TO QW15
STORE " " TO QW16
STORE " " TO QW17
STORE " " TO QW18
STORE " " TO QW19
STORE " " TO QW20
STORE " " TO QW21
STORE " " TO QW22
STORE " " TO QW23
STORE " " TO QW24
STORE " " TO QW25
STORE " " TO QW26
STORE " " TO QW27
STORE " " TO QW28
STORE " " TO QW29
STORE " " TO QW30
STORE " " TO QW31
STORE " " TO QW32
STORE " " TO QW33
STORE " " TO QW34
STORE " " TO QW35
STORE " " TO QW36
STORE " " TO QW37
STORE " " TO QW38
STORE " " TO QW39
STORE " " TO QW40
STORE QW01+QW02+QW03+QW04+QW05+QW06+QW07+QW08+QW09+QW10+;
      QW11+QW12+QW13+QW14+QW15+QW16+QW17+QW18+QW19+QW20+;
      QW21+QW22+QW23+QW24+QW25+QW26+QW27+QW28+QW29+QW30+;
      QW31+QW32+QW33+QW34+QW35+QW36+QW37+QW38+QW39+QW40 TO QQWW
RETURN
******
